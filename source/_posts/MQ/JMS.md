---
title: JMS
date: 2021-07-09 00:00:00
author: 神奇的荣荣
summary: ""
categories: MQ
tags: 
    - MQ
    - 中间件
---

# JMS简介

## JMS是什么

JMS即Java消息服务（Java Message Service）应用程序接口，是一个Java平台中关于面向消息中间件（MOM，Message oriented Middleware）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。  
Java消息服务是一个与具体平台无关的API，绝大多数MOM提供商都对JMS提供支持。

JMS允许应用程序组件基于JavaEE平台创建、发送、接收和读取消息。它使分布式通信耦合度更低，消息服务更加可靠以及异步性。

## 为什么需要JMS

在JAVA中，如果两个应用程序之间对各自都不了解，甚至这两个程序可能部署在不同的大洲上，那么它们之间如何发送消息呢？举个例子，一个应用程序A部署在印度，另一个应用程序部署在美国，然后每当A触发某件事后，B想从A获取一些更新信息。
当然，也有可能不止一个B对A的更新信息感兴趣，可能会有N个类似B的应用程序想从A中获取更新的信息。

在这种情况下，JAVA提供了最佳的解决方案-JMS，完美解决了上面讨论的问题。

JMS同样适用于基于事件的应用程序，如聊天服务，它需要一种发布事件机制向所有与服务器连接的客户端发送消息。JMS与RMI不同，发送消息的时候，接收者不需要在线。服务器发送了消息，然后就不管了；
等到客户端上线的时候，能保证接收到服务器发送的消息。这是一个很强大的解决方案，能处理当今世界很多普遍问题。

## JMS有什么优势

1）异步：JMS天生就是异步的，客户端获取消息的时候，不需要主动发送请求，消息会自动发送给可用的客户端。
2）可靠：JMS保证消息只会递送一次。大家都遇到过重复创建消息问题，而JMS能帮你避免该问题，只是避免而不是杜绝，所以在一些糟糕的环境下还是有可能会出现重复。

<!-- more -->

# JMS体系架构

## JMS体系架构

JMS由以下元素组成。

1）JMS提供者   
连接面向消息中间件的，JMS接口的一个实现。提供者可以是Java平台的JMS实现，也可以是非Java平台的面向消息中间件的适配器。

2）JMS客户   
生产或消费消息的基于Java的应用程序或对象。

3）JMS生产者   
创建并发送消息的JMS客户。

4）JMS消费者   
接收消息的JMS客户。

5）JMS消息   
包括可以在JMS客户之间传递的数据的对象

6）JMS队列   
一个容纳那些被发送的等待阅读的消息的区域。队列暗示，这些消息将按照顺序发送。一旦一个消息被阅读，该消息将被从队列中移走。

7）JMS主题 
一种支持发送消息给多个订阅者的机制。

## 工作流程

# JMS消息模型

## JMS消息模型

1）Point-to-Point(P2P)  
2）Publish/Subscribe(Pub/Sub)

在JMS API出现之前，大部分产品使用“点对点”和“发布/订阅”中的任一方式来进行消息通讯。JMS定义了这两种消息发送模型的规范，它们相互独立。
任何JMS的提供者可以实现其中的一种或两种模型，这是它们自己的选择。JMS规范提供了通用接口保证我们基于JMS API编写的程序适用于任何一种模型。

## P2P（点对点）

![P2P模式](https://rong0624.github.io/images/MQ/JMS/397872-20170315231815541-1387998695.jpeg)

### 涉及的概念

1）消息队列(Queue)    
2）提供者(Sender)  
3）消费者(Receiver)  
4）每个消息都被发送到一个特定的队列，接收者从队列中获取消息。队列保留着消息，直到他们被消费或超时。

### P2P的特点

1）每个消息只有一个消费者（Consumer）(即一旦被消费，消息就不再在消息队列中)  
2）提供者和消费者之间在时间上没有依赖性，也就是说当提供者发送了消息之后，不管消费者有没有正在运行，它不会影响到消息被发送到队列  
3）每条消息仅会传送给一个消费者。可能会有多个消费者在一个队列中侦听，但是每个队列中的消息只能被队列中的一个消费者所消费。  
4）消息存在先后顺序。一个队列会按照消息服务器将消息放入队列中的顺序，把它们传送给消费者。当已被消费时，就会从队列头部将它们删除（除非使用了消息优先级）。  
5）消费者在成功接收消息之后需向队列应答成功  

**注意：如果你希望发送的每个消息都应该被成功处理的话，那么你需要P2P模式。**

## Pub/Sub（发布/订阅模式）

![Pub/Sub模式](https://rong0624.github.io/images/MQ/JMS/397872-20170315232442979-934776600.jpeg)

### 涉及的概念

1）主题（Topic）  
2）发布者（Publisher）  
3）订阅者（Subscriber）  
4）客户端将消息发送到主题。多个发布者将消息发送到Topic,系统将这些消息传递给多个订阅者。

### Pub/Sub的特点

1）每个消息可以有多个消费者。  
2）发布者和订阅者之间有时间上的依赖性。针对某个主题的订阅者，它必须创建一个订阅者之后，才能消费发布者的消息，而且为了消费消息，订阅者必须保持运行的状态。  
3）为了缓和这样严格的时间相关性，JMS允许订阅者创建一个可持久化的订阅。这样，即使订阅者没有被激活（运行），它也能接收到发布者的消息。  
4）每条消息都会传送给称为订阅者的多个消息消费者。订阅者有许多类型，包括持久型、非持久型和动态型。  
5）发布者通常不会知道、也意识不到哪一个订阅者正在接收主题消息。  
6）消息被推送给消费者，这意味着消息会传送给消费者，而无须请求。

**如果你希望发送的消息可以不被做任何处理、或者被一个消息者处理、或者可以被多个消费者处理的话，那么可以采用Pub/Sub模型**

# JMS消息



# JMS 应用程序接口

1. ConnectionFactory 接口(连接工厂)
    - 创建Connection对象的工厂，根据消息类型的不同，用户将使用队列连接工厂，或者主题连接工厂
    - 分别有QueueConnectionFactory和TopicConnectionFactory两种。可以通过JNDI来查找ConnectionFactory对象。
2. Destination 接口(目标)
    - Destination是一个包装了消息目标标识符的被管对象，消息目标是指消息发布和接收的地点，或者是队列，或者是主题。
    - 是消息生产者的消息发送目标或者说消息消费者的消息来源。对于消息生产者来说，它的Destination是某个队列（Queue）或某个主题（Topic）;
    - 对于消息消费者来说，它的Destination也是某个队列或主题（即消息来源）。
    - 所以，Destination实际上就是两种类型的对象：Queue、Topic可以通过JNDI来查找Destination。
3. Connection 接口(连接)
    - Connection表示在客户端和JMS系统之间建立的链接（对TCP/IP socket的包装）。
    - Connection可以产生一个或多个Session。跟ConnectionFactory一样，Connection也有两种类型：QueueConnection和TopicConnection。
4. Session 接口(会话)
    - Session是我们操作消息的接口。表示一个单线程的上下文，用于发送和接收消息。
    - 由于会话是单线程的，所以消息是连续的，就是说消息是按照发送的顺序一个一个接收的。
    - 可以通过session创建生产者、消费者、消息等。Session提供了事务的功能。当我们需要使用session发送/接收多个消息时，可以将这些发送/接收动作放到一个事务中。
    - 同样，也分QueueSession和TopicSession。
5. MessageProducer 接口(消息的生产者)
    - 消息生产者由Session创建，并用于将消息发送到Destination。消费者可以同步地（阻塞模式），或异步（非阻塞）接收队列和主题类型的消息。
    - 同样，消息生产者分两种类型：QueueSender和TopicPublisher。可以调用消息生产者的方法（send或publish方法）发送消息。
6. MessageConsumer 接口(消息消费者)
    - 消息消费者由Session创建，用于接收被发送到Destination的消息。两种类型：QueueReceiver和TopicSubscriber。
    - 可分别通过session的createReceiver(Queue)或createSubscriber(Topic)来创建。
    - 当然，也可以session的creatDurableSubscriber方法来创建持久化的订阅者。
7. Message 接口（消息）
    - 是在消费者和生产者之间传送的对象，也就是说从一个应用程序创送到另一个应用程序。
    - 一个消息有三个主要部分：
        - 1、消息头（必须）：包含用于识别和为消息寻找路由的操作设置。
        - 2、一组消息属性（可选）：包含额外的属性，支持其他提供者和用户的兼容。可以创建定制的字段和过滤器（消息选择器）。
        - 3、一个消息体（可选）：允许用户创建五种类型的消息（文本消息，映射消息，字节消息，流消息和对象消息）。消息接口非常灵活，并提供了许多方式来定制消息的内容。
    - 消息接口非常灵活，并提供了许多方式来定制消息的内容。
8. MessageListener
    - 消息监听器。如果注册了消息监听器，一旦消息到达，将自动调用监听器的onMessage方法。
    - EJB中的MDB（Message-Driven Bean）就是一种MessageListener。

![JMS 应用程序接口](https://rong0624.github.io/images/MQ/JMS/20170215230025420.png)

# JMS提供者实现

要使用Java消息服务，你必须要有一个JMS提供者，管理会话和队列。现在既有开源的提供者也有专有的提供者。  
开源的提供者包括：Apache ActiveMQ、Kafka、WebMethods、阿里的RocketMQ等。

# 参考资料

https://www.cnblogs.com/molao-doing/articles/6557305.html